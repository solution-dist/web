#!/usr/bin/env bun
import {client,Component,router,html,css,SmartFormComponent,createElement,state}from'@je-es/client';import {table,primaryKey,notNull,text,defaultValue,integer,server}from'@je-es/server';import bt from'path';var pt=Object.create;var b=Object.defineProperty;var G=(t,o)=>(o=Symbol[t])?o:Symbol.for("Symbol."+t),T=t=>{throw TypeError(t)};var ht=(t,o,e)=>o in t?b(t,o,{enumerable:true,configurable:true,writable:true,value:e}):t[o]=e;var V=(t,o)=>()=>(t&&(o=t(t=0)),o);var q=(t,o)=>{for(var e in o)b(t,e,{get:o[e],enumerable:true});};var $=t=>[,,,pt(t?.[G("metadata")]??null)],P=["class","method","getter","setter","accessor","field","value","get","set"],y=t=>t!==void 0&&typeof t!="function"?T("Function expected"):t,ut=(t,o,e,r,s)=>({kind:P[t],name:o,metadata:r,addInitializer:i=>e._?T("Already initialized"):s.push(y(i||null))}),A=(t,o)=>ht(o,G("metadata"),t[3]),u=(t,o,e,r)=>{for(var s=0,i=t[o>>1],d=i&&i.length;s<d;s++)o&1?i[s].call(e):r=i[s].call(e,r);return r},v=(t,o,e,r,s,i)=>{var l,D,g,x,n=o&7,E=false,h=false,S=t.length+1,O=(t[S-1]=[]),ct=t[S]||(t[S]=[]);((s=s.prototype),n<5);for(var C=r.length-1;C>=0;C--)g=ut(n,e,D={},t[3],ct),(g.static=E,g.private=h,x=g.access={has:c=>e in c},(x.get=c=>c[e]),(x.set=(c,k)=>c[e]=k)),l=(0, r[C])(void 0,g),D._=1,y(l)&&(O.unshift(l));return s};var Q={};q(Q,{HomePage:()=>j});var j,Z=V(()=>{j=class extends Component{async onMount(){}handleGetStarted(o){o.preventDefault(),router.push("/todos");}render(){return html`
                <div class="home-page">
                    <section class="hero-section">
                    </section>
                </div>
            `}styles(){return css`
            `}};});var it={};q(it,{TodoPage:()=>f});var et,ot,rt,st,nt,p,f,at=V(()=>{f=class extends(nt=Component,st=[state],rt=[state],ot=[state],et=[state],nt){constructor(e){super(e);this.todos=u(p,8,this,[]),u(p,11,this);this.loading=u(p,12,this,false),u(p,15,this);this.filter=u(p,16,this,"all"),u(p,19,this);this.formInstance=u(p,20,this,null),u(p,23,this);this.handleToggleTodo=async e=>{let r=this.todos.find(s=>s.id===e);if(r)try{await fetch(`/api/todos/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({completed:r.completed?0:1})}),await this.loadTodos();}catch(s){console.error("\u274C Failed to toggle todo:",s);}};this.handleDeleteTodo=async e=>{try{await fetch(`/api/todos/${e}`,{method:"DELETE"}),this.todos=this.todos.filter(r=>r.id!==e);}catch(r){console.error("\u274C Failed to delete todo:",r),await this.loadTodos();}};this.handleSetFilter=e=>{this.filter=e,localStorage.setItem("todo-filter",e);};this.formInstance=new SmartFormComponent(this.getFormConfig());}get filteredTodos(){return this.memo("filteredTodos",()=>{let e=this.todos||[];switch(this.filter){case "active":return e.filter(r=>!r.completed);case "completed":return e.filter(r=>r.completed);default:return e}},[this.todos,this.filter])}get stats(){return this.memo("stats",()=>{let e=this.todos||[];return {total:e.length,active:e.filter(r=>!r.completed).length,completed:e.filter(r=>r.completed).length}},[this.todos])}async onMount(){await this.loadTodos();}async loadTodos(){this.loading=true;try{let r=await(await fetch("/api/todos")).json();this.todos=Array.isArray(r)?r:[];}catch(e){console.error("\u274C Failed to load todos:",e),this.todos=[];}finally{this.loading=false;}}getFormConfig(){return {fields:[{name:"title",type:"text",placeholder:"What needs to be done",className:"todo-input-field",validation:{required:true,minLength:1,message:"Task title is required"}}],endpoint:"/api/todos",method:"POST",autoValidate:true,submitButton:{label:"\u2795 Add Task",loadingLabel:"\u23F3 Adding...",className:"add-button"},className:"todo-form",onSuccess:async e=>{this.formInstance=new SmartFormComponent(this.getFormConfig()),await this.loadTodos();},onError:e=>{console.error("\u274C Failed to create todo:",e);}}}render(){let e=this.stats,r=this.filteredTodos;return createElement("div",{className:"todo-page"},createElement("div",{className:"page-header"},createElement("h1",{},"My Todos"),createElement("p",{className:"page-description"},"Organize your tasks and boost your productivity")),this.loading?createElement("div",{className:"loading"},"\u23F3 Loading..."):null,createElement("div",{className:"todo-form-card"},this.formInstance?this.formInstance.render():createElement("div",{},"Loading form...")),createElement("div",{className:"filter-tabs"},this.createFilterButton("all","All",e.total),this.createFilterButton("active","Active",e.active),this.createFilterButton("completed","Completed",e.completed)),r.length===0&&!this.loading?createElement("div",{className:"empty-state"},createElement("div",{className:"empty-icon"},"\u{1F4DD}"),createElement("h3",{},this.filter==="all"?"No todos yet":`No ${this.filter} todos`),createElement("p",{},this.filter==="all"?"Add your first task above to get started!":'Switch to "All" to see all todos')):null,r.length>0?createElement("div",{className:"todos-list"},...r.map(s=>this.renderTodoItem(s))):null)}createFilterButton(e,r,s){let i=this.filter===e;return createElement("button",{className:i?"filter-btn active":"filter-btn",onclick:()=>this.handleSetFilter(e)},`${r} (${s})`)}renderTodoItem(e){let r=()=>this.handleToggleTodo(e.id),s=()=>this.handleDeleteTodo(e.id);return createElement("div",{className:e.completed?"todo-item completed":"todo-item",key:String(e.id)},createElement("input",{type:"checkbox",className:"todo-checkbox",checked:!!e.completed,onchange:r}),createElement("span",{className:"todo-title"},e.title),createElement("button",{className:"delete-button",onclick:s,title:"Delete task"},"\u2715"))}styles(){return ""}};p=$(nt),v(p,5,"todos",st,f),v(p,5,"loading",rt,f),v(p,5,"filter",ot,f),v(p,5,"formInstance",et,f),A(p,f);});var z=table("todos",[primaryKey(integer("id"),true),notNull(text("title")),text("text"),defaultValue(integer("completed"),0),defaultValue(text("created_at"),new Date().toISOString())]);var H=process.env.PORT||3e3,K=process.env.HOSTNAME||"localhost",wt=(process.env.CORS_ORIGINS||`http://${K}:${H}`).split(","),Nt=process.env.LOG_LEVEL||"info",xt=process.env.STATIC_PATH||"/static",Et=bt.resolve(process.env.STATIC_DIR||"./src/frontend/static"),St=process.env.DATABASE_URL||"{{name}}.db",J={port:H,hostname:K,requestTimeout:3e4,maxRequestSize:10485760,routes:[],static:{path:xt,directory:Et},security:{rateLimit:{max:100,windowMs:6e4,message:"Too many requests. Please try again later.",keyGenerator:t=>t.request?.headers?.get?.("x-api-key")||t.ip||"unknown"},cors:{origin:wt,credentials:true,methods:["GET","POST","PUT","DELETE","PATCH"],allowedHeaders:["Content-Type","Authorization","X-Request-ID"]},csrf:true},logging:{level:Nt,pretty:true},database:{connection:St,schema:{todos:z}},onShutdown:async()=>{}};var W=[{method:"GET",path:"/api/todos",handler:async t=>{try{let o=t.db.all("todos");return t.json(o,200)}catch(o){return console.error("Error fetching todos:",o),t.json({error:"Failed to fetch todos"},500)}}},{method:"GET",path:"/api/todos/:id",handler:async t=>{try{let o=parseInt(t.params.id),e=t.db.findById("todos",o);return e?t.json(e,200):t.json({error:"Todo not found"},404)}catch(o){return console.error("Error fetching todo:",o),t.json({error:"Failed to fetch todo"},500)}}},{method:"POST",path:"/api/todos",handler:async t=>{try{let o=t.body,{title:e,text:r}=o;if(!e||e.trim()==="")return t.json({error:"Title is required"},400);let s=t.db.insert("todos",{title:e.trim(),text:r||null,completed:0,created_at:new Date().toISOString()});return t.json(s,201)}catch(o){return console.error("Error creating todo:",o),t.json({error:"Failed to create todo"},500)}}},{method:"PUT",path:"/api/todos/:id",handler:async t=>{try{let o=parseInt(t.params.id),e=t.body,{title:r,text:s,completed:i}=e,d={};if(r!==void 0&&(d.title=r),s!==void 0&&(d.text=s),i!==void 0&&(d.completed=i),Object.keys(d).length===0)return t.json({error:"No fields to update"},400);let l=t.db.update("todos",o,d);return l?t.json(l,200):t.json({error:"Todo not found"},404)}catch(o){return console.error("Error updating todo:",o),t.json({error:"Failed to update todo"},500)}}},{method:"DELETE",path:"/api/todos/:id",handler:async t=>{try{let o=parseInt(t.params.id);return t.db.delete("todos",o)?t.json({success:!0,id:o},200):t.json({error:"Todo not found"},404)}catch(o){return console.error("Error deleting todo:",o),t.json({error:"Failed to delete todo"},500)}}}];var Y=[...W,{method:"GET",path:"/",handler:t=>{let o=X();return t.html(o,200)}},{method:"GET",path:"/todos",handler:t=>{let o=X();return t.html(o,200)}}],X=(t="http://localhost:3000")=>`
            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8" />
                <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                <title>{{title}}</title>

                <link rel="stylesheet" href="static/css/client.css">
            </head>
            <body id="app">
                <script type="module" src="static/js/client.js"></script>
            </body>
            </html>
        `;var w=server({...J,routes:Y});var dt=[{path:"/",component:()=>Promise.resolve().then(()=>(Z(),Q)),meta:{title:"Home"}},{path:"/todos",component:()=>Promise.resolve().then(()=>(at(),it)),meta:{title:"Todos"}}];var lt=client({build:{entry:"./src/frontend/app/browser.ts",output:"./src/frontend/static/js/client.js",minify:process.env.NODE_ENV==="production",sourcemap:process.env.NODE_ENV==="development"},app:{root:"#app",routes:dt,mode:"spa"},router:{mode:"history",base:"/",scrollBehavior:"smooth"},api:{baseURL:process.env.NODE_ENV==="production"?"https://api.myapp.com":"http://localhost:3000",timeout:3e4,headers:{"Content-Type":"application/json"},interceptors:{request:t=>{let o=localStorage.getItem("token");return o&&(t.headers.Authorization=`Bearer ${o}`),t},error:t=>{throw t.status===401&&(localStorage.removeItem("token"),window.location.href="/login"),t}}},forms:{autoValidate:true,csrfProtection:true},devTools:{enabled:process.env.NODE_ENV==="development",showRouterInfo:true}});async function Bt(){process.on("SIGTERM",async()=>{await w.stop(),process.exit(0);}),process.on("SIGINT",async()=>{await w.stop(),process.exit(0);}),await lt.build(),w.start().then(()=>{}).catch(t=>{console.error("\u274C Failed to start server:",t),process.exit(1);});}Bt();//# sourceMappingURL=main.js.map
//# sourceMappingURL=main.js.map